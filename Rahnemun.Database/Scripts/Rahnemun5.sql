IF object_id(N'[dbo].[FK_dbo.Rahnemun_Categories_dbo.Rahnemun_CategoryGroups_CategoryGroup_Id]', N'F') IS NOT NULL
    ALTER TABLE [dbo].[Rahnemun_Categories] DROP CONSTRAINT [FK_dbo.Rahnemun_Categories_dbo.Rahnemun_CategoryGroups_CategoryGroup_Id]
IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_CategoryGroup_Id' AND object_id = object_id(N'[dbo].[Rahnemun_Categories]', N'U'))
    DROP INDEX [IX_CategoryGroup_Id] ON [dbo].[Rahnemun_Categories]
EXECUTE sp_rename @objname = N'dbo.Rahnemun_Categories.CategoryGroup_Id', @newname = N'CategoryGroupId', @objtype = N'COLUMN'
ALTER TABLE [dbo].[Rahnemun_Categories] ADD [DisplayOrder] [tinyint] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[Rahnemun_CategoryGroups] ADD [DisplayOrder] [tinyint] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[Rahnemun_Categories] ALTER COLUMN [CategoryGroupId] [int] NOT NULL
CREATE INDEX [IX_CategoryGroupId] ON [dbo].[Rahnemun_Categories]([CategoryGroupId])
ALTER TABLE [dbo].[Rahnemun_Categories] ADD CONSTRAINT [FK_dbo.Rahnemun_Categories_dbo.Rahnemun_CategoryGroups_CategoryGroupId] FOREIGN KEY ([CategoryGroupId]) REFERENCES [dbo].[Rahnemun_CategoryGroups] ([Id]) ON DELETE CASCADE
GO --we need GO command if we wanna run it from SQL Server Management Studio
Update dbo.Rahnemun_Categories SET dbo.Rahnemun_Categories.DisplayOrder = Temp.DisplayOrder FROM dbo.Rahnemun_Categories  INNER JOIN (SELECT Id, ROW_NUMBER() OVER(PARTITION BY [CategoryGroupId] ORDER BY [CategoryGroupId]) AS [DisplayOrder] FROM dbo.Rahnemun_Categories) AS Temp ON Temp.Id = dbo.Rahnemun_Categories.Id
Update dbo.Rahnemun_CategoryGroups SET dbo.Rahnemun_CategoryGroups.DisplayOrder = Temp.DisplayOrder FROM dbo.Rahnemun_CategoryGroups INNER JOIN (SELECT [Id], ROW_NUMBER() OVER(ORDER BY [Id]) AS [DisplayOrder] FROM [Rahnemun].[dbo].[Rahnemun_CategoryGroups]) AS Temp ON Temp.Id = dbo.Rahnemun_CategoryGroups.Id
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201411060954156_Rahnemun5', N'Rahnemun.Database.RahnemunMigrations.Configuration',  0x1F8B0800000000000400ED5CDB6EE4B8117D0F907F10F494045E77B79D1D6C0C7B179EB6BD3132BE60DAB3C99B414B743731D46525CA7123C897E5219F945F4851578AA4245256DBCE66312F6E5E4E158B7513599CFFFCEBDFC73F3C07D479C2494AA2F0C45DECCF5D07875EE493707DE266ECF19BEFDC1FBEFFED6F8ECFFDE0D9F9A91A77C8C7C1CC303D71378CC547B359EA6D7080D2FD80784994468F6CDF8B8219F2A3D9C17CFEA7D96231C300E10296E31C7FCE4246029CFF809FCB28F470CC3244AF221FD3B46C879E558EEA5CA300A731F2F089FB196D421C64E1FE59142012BACE292508D85861FAE83A280C2386183079F425C52B9644E17A154303A277DB18C3B84744535C327FD40C375DC7FC80AF63D64CACA0BC2C65C0911DE0E2B014CC4C9E3E4ABC6E2D3810DD3988986DF9AA73F19DB84BC4F03A4AB6AE23133B5AD2840F54A4BB5FCDD973A49EBD5A194067F8BF3D6799519625F824C4194B10DD736EB3074ABCBFE0ED5DF41587276146A9C821F0087DAD0668BA4DA218276CFB193F967C5FFAAE336BCF9BC913EB69C29C624597213B3C709D6B208E1E28AE154058FD8A4509FE11873881D5FAB788319C841C03E72254A84BB496282E76AC20084A07C6E33A57E8F9130ED76C73E27E0BD672419EB15F35943C7C0909981ACC614986353CF6D33D23694CD1F626F1715211FFB865F640D526FF9844593C2C3909EC1A3D91752EC83E58D7F98C693E2ADD90B830D7FDD688FBF217C129482B8982CF1195518431F77728596306CC46030357519678367C038FA0CA2864692FD7F7AD812AC7627FCD84CC6D6B50B52491D3E35963C846E65D8ADBDEC6F389BF1AFA2FC9D0876C33B7B5A90DB34BD53B2D789CBAD77663A5EBF5ACC914DDF988525C6A04971DE41D89DBBB9FAB187B909070857B654DFA88C2AF4B94F8D7510FE9C5875D913EF5BC0832BF5EEA87660B1F26C6FF7AB980FBE99CFB9987067CC2623EDFC95EC2CF479C728545F4FC197A0824EE7D2BDE15239F8887C3145F67C143E39F76B5B3E2AA97D04E1E09EC00F74C2F5F773FE5BF46C9D753DF4F807AEF227722634EFC761385B8D77676E33420EC218F34DEEA4539E6F4E9E574395A5746A94DE44605AD3C3658842B3EFEFF3123BB064D1FD2A83B12E094A120AEF5928488AB033F4DC89204BCE1F62AD7FADC245A86F29DDE4E4670BA8C823863589593C4ED0549523610920C1DA4AD7B466F4418842524ACB959564D96487598FD849F306D21CA5D96C8D7F95C441BA5D5069009C2C7154A08437405EA94A5AD25483DB68E15531A0F4686C5628AAC8A246C738658AD4AFC6F6E86D64C5F812DF5707B304DC4E6B902A1F89678DC392A7EC9CC836781E0BF2BFDBD4C2F285A37A789061E1D1C451085A505083EBD681FFDF1F185C3D12D485008CE6DA95C619E98D56A4881DF9F10CDE0C75C91606BEC050EC4D10B556485707A04269BE778C1B591DE4E80B7090920CCACBC4D145153495E11DFA7589AB3E89FF367B2DE48330EFA67DC26F823F2369846493DE5B07F8A32FE8F030B8160829BD1DFF68F3E8B3C889AB9C328277C18A143927F1CAF422DA0B7D3A0158C343742601ABEEC7C3B2B3C4DD3C823B93874A783E2894E9BF479E83BA6C73B4D04938E1EAF406C2406418143E50CCB79E64D78862966D839F58A9B92254A3DE4ABFE1CD6E65BF35767F12A7F326B7F502842EA8B137E1A085F9790F4C3AE9390A97932093D12236A282A69BE61A6CDD75F53927BCE70CC0349C80CA561C282720DA0F2539395F669486CC7334123CD14B5F5E536A404FAA3F66105505DF000B64EB98483C89DAA976E91AFA85A3A39D8A8D52B695491C7C11C06336A2F5AF97AC85811EFC3CFBA6363F8DC2E83475A6698B27270EC15669A53F4267F54744E51312D4A61777D48A57B1D80E367063A94E2EC419A2C08B183A1D6E9BF307CE8A640DE698BC852AF48958DA24016014185CDD724C79CB6482CC4D53E6BEA1655B76733F76D466B317767025CA93EC652A9BE9C6A8B6B8A376645F54655E531EB28F338BE42710C399150F651B638ABA2E663F9CDCABE1E222830665EAA298BA8B9AD29F144758DA55E7EBEE3E3FCEC867B8E07C413CEA51F28C374FEA5C34C2B8A8A0B51F7AEB2E06A0AFFBBEDCFE43B5C8D472E275FC0F202EED5F3832C8D89A953F3FA1B4451A239E15B46340BC2EE00D33DBBBE451521EA46739CF6ADA808D6EEB1E14C4A80DA1C0E64475CC325592BD14ED95225DF6D2B898D0A553E720A352A22CD785DEA98FF4B55A837DAF8C255BF68BF9BDCD57EB32BB0BE78B6AB3D17AED04510A1D91C4BBC1417C1C4763B34E19E5B0614BAEC308B237C19AE683547122EAC4528A1D91CABEB025A04EE1A634E45BA5D16C1A5AE719CB72F91BB786F8F32A7D4BA3416C15B1D7678F53DB08C577758F9CEF26E57729E65AB7DF0EC8A9BBB099903FEEE32E57FDF3CFE4E77B1FAFB113E4F2DEEE993C9CB7C9C70C1298208CDE658C2F5A38825345B5824D24135ADE648D5758A8853B58DF069E51D83D6B1957DE6A8E2CDA08828B69BA34967D822A0D4656171E2CD5FCBE4C40E8B28D35CEFB5C24CD36CB1DEFC82AFB5CCBCC5CE47B72FEF64DFDCEE7DE5AC4CF9EC9587D4D4EBCF5FE933F7B8FCE41C7EF2A07C8316435C07A4F0447CFEFDB9DAA60C07FB7CC0FEEA67BAA410675933E00A850462192BAE2DDC83F9E2407A38F17E1E31CCD2D4A7862F19DAFBF50A252D844B75B08CD8BEC04AAC210C9F50E26D50A294764D5036CC48B8CDD730CD1301A2ADBEBD040FFE7CE2FE239F7BE45CFEED5E9ABEE7E44C1D3973E79F03AC8C2C7FFF553176A21876856E6FB30996C250CAC892E8EFE57BB8CE0D6D8ABE2C89295560DA2D3DB4DF52B9C86B2ADC760DD758EFA1AFDF1A8BA6D66C6957BB68AD767489D6688FA9D665E9D95CD8B2A99461F9F0377B69199696B9A210CB8EBDAEAA2B49882A94B173193E787A35676310FBACC29D4A50792C32551450DF82E8F5F3C3344F3D0C3CD298971D06D218F590A3C3A5CCEDE5DCFF4E633A3ADA671813497DE8D585D12A463EB2E85882BD80346F28A6B225F989C44BD3ECF119F624C9F5D4E563EFA658ECCDAAC25EB350E77FA9D8AB0EE0F77C631AB87BFE54E79E7F45DCDF45F70601BFD9EBA2CE45297C312FFCD2521301F503DA04E6FBFB2A8D517AA43F729E5E7DCCAEF38CE9BED752C117D7054EA21E13FB9877AD1FEFA20050ADE391F7575F94D75BD8579CC3C207D803CF288A30DB88A9BBC6ACB70270B800D0846C47C59CB65AB0B358B09790BE504CC6D71B83424F3FAC7FA1E2C8F756D6D85DC46854A4A79D3E45A9E20BE2AD4E4A53856F4D00972F5DFBC4D6A764DDA52ABBA9FC5C4C58FA69A406AF2A098B6A4FF57A0B9CBAF0FF7E418049C9BA81E0FF0B5888BD963BAFC75C868F511559248EAA21F2D91666C8075F7FCABF5691C7A0DBE39FB0FCA961F994E61CBE94FDCBF0266371C660C93878A02DF1F2E8D4473F2F696DF37C7C931FD9A7532C01D824FC6CEF26FC9811DA3C01BAD07CC97540F0B0579E5FF3BD64FC1C7BBDAD91D477D65D40A5F8EA687D878398F223809B70859EF018DEC0AC3FE135F2B6D52D6537C8F046B4C57E7C46D03A41415A6234F3E127E8B01F3C7FFF5FF06C5977FE4E0000 , N'6.1.1-30610')

